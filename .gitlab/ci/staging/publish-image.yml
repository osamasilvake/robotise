publish-image-stg:
  stage: Publish Image
  script:
    # publish to GCP container registry
    - docker load -i images/release.tar
    - cat $GCP_CR_SERVICE_ACCOUNT_KEY | docker login -u _json_key --password-stdin "https://$GCP_CONTAINER_REGISTRY_HOSTNAME"
    - docker tag release "$GCP_CONTAINER_REGISTRY_HOSTNAME/$GCP_PROJECT/$CI_PROJECT_NAME:master"
    - docker push "$GCP_CONTAINER_REGISTRY_HOSTNAME/$GCP_PROJECT/$CI_PROJECT_NAME:master"
  environment:
    name: staging
  only:
    - master